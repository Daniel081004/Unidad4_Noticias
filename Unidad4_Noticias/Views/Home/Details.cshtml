@model Unidad4_Noticias.Models.ViewModels.DetailsViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = "_Layout";
}




@section HeaderButtons {
    <a href="~/Home/Index" class="back-button">
        <i class="fas fa-arrow-left"></i>
        <span>Volver</span>
    </a>
}


<article class="news-header">
    <h1 class="news-title">@Model.Titulo</h1>

    <div class="news-meta">
        <span class="meta-item">
            <i class="fas fa-user-edit"></i> @Model.Autor
        </span>
        <span class="meta-item">
			<i class="far fa-calendar"></i> @Model.FechaPublicacion.ToString("dd 'de' MMMM 'de' yyyy")
        </span>
    </div>
    @if (User.IsInRole("Admin") || User.Identity?.Name == Model.Autor)
    {
        <div class="news-actions">
            <a href="~/Reportero/Noticias/Edit/@(Model.Id)" class="action-button edit-button">
                <i class="fas fa-edit"></i>
                Editar Noticia
            </a>
            <button class="action-button delete-button" data-type="noticia" data-id="1">
                <i class="fas fa-trash"></i>
                Eliminar Noticia
            </button>
        </div>
    }
    
    <div class="news-image-container">
        @{
            //Leer la imagen en upload
            var archivo = Directory.GetFiles("wwwroot/uploads", Model.Id + ".*").Select(x => System.IO.Path.GetFileName(x)).FirstOrDefault();
        }
        <img src="~/uploads/@(archivo)" alt="Inteligencia Artificial" class="news-image">
    </div>
</article>

<section class="news-content">
    @Html.Raw(Model.Contenido)
</section>

<section class="comments-section">
    <h2 class="comments-title">Comentarios</h2>

    <form class="comment-form" method="post" action="~/Home/Comentar">
        <input type="hidden" asp-for="Id" value="@Model.Id" />
        <input type="hidden" asp-for="Titulo"/>
        <textarea asp-for="NuevoComentario.Contenido" class="comment-input" placeholder="Escribe tu comentario..." required></textarea>
        <button  type="submit" class="submit-button">Publicar Comentario</button>
    </form>

    <div class="comments-list">
        @if(Model.Comentarios != null)
        {
            @foreach (var c in Model.Comentarios)
            {
                <div class="comment">
                    <div class="comment-header">
                        <div class="comment-author">
                            <span>@c.Autor</span>
                        </div>
                        <span class="comment-date">@c.TiempoRelativo</span>
                    </div>
                    <p class="comment-content">@c.Contenido</p>

                    <div class="comment-actions">
                        <button class="delete-comment" data-type="comentario" data-id="101">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            }
        }    
    </div>
</section>


<div class="modal" id="confirmModal" >
        <form>
            <h3 class="modal-title" id="modalTitle">Confirmar eliminación</h3>
            <p class="modal-message" id="modalMessage">¿Estás seguro de que quieres eliminar este elemento?</p>
            <div class="modal-actions">
                <button class="modal-button modal-cancel" id="modalCancel">Cancelar</button>
                <button class="modal-button modal-confirm" id="modalConfirm">Eliminar</button>
            </div>
        </form>
</div>